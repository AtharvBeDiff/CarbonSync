<!DOCTYPE html>
<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1" name="viewport"/>
  <title>
   Project Details | BlueCarbonMRV
  </title>
  <!-- Google Font: Poppins -->
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@100;300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
  <!-- Bootstrap 5 CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <!-- Font Awesome 6 -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet"/>
  <!-- Leaflet CSS -->
  <link crossorigin="" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" rel="stylesheet"/>
  <!-- SweetAlert2 CSS (optional since default styles are bundled) -->
  <link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet"/>
  <!-- Site Theme CSS -->
  <link href="style.css" rel="stylesheet"/>
  <!-- Page-specific CSS -->
  <link href="project_details_page.css" rel="stylesheet"/>
 </head>
 <body>
  <!-- Public/Guest Header -->
  <nav class="navbar navbar-expand-lg bg-white border-bottom sticky-top">
   <div class="container-fluid">
    <button aria-controls="sidebarMenu" class="btn btn-outline-success me-2 d-lg-none" data-bs-target="#sidebarMenu" data-bs-toggle="offcanvas" type="button">
     <i class="fa-solid fa-bars">
     </i>
    </button>
    <a class="navbar-brand d-flex align-items-center" href="./home_page.html">
     <span class="rounded-circle bg-success-subtle p-2 me-2">
     </span>
     <span class="brand-text">
      BlueCarbonMRV
     </span>
    </a>
    <button aria-controls="publicNav" aria-expanded="false" aria-label="Toggle navigation" class="navbar-toggler" data-bs-target="#publicNav" data-bs-toggle="collapse" type="button">
     <span class="navbar-toggler-icon">
     </span>
    </button>
    <div class="collapse navbar-collapse" id="publicNav">
     <ul class="navbar-nav me-auto mb-2 mb-lg-0">
      <li class="nav-item">
       <a class="nav-link" data-page="marketplace_page" href="./marketplace_page.html">
        Projects
       </a>
      </li>
      <li class="nav-item">
       <a class="nav-link" href="./home_page.html#how-it-works">
        How It Works
       </a>
      </li>
      <li class="nav-item">
       <a class="nav-link" href="./home_page.html">
        Home
       </a>
      </li>
     </ul>
     <!-- Search (primarily visible/used on marketplace_page) -->
     <form class="d-none d-lg-flex me-3" role="search">
      <div class="input-group">
       <span class="input-group-text bg-white">
        <i class="fa-solid fa-magnifying-glass text-muted">
        </i>
       </span>
       <input aria-label="Search" class="form-control" placeholder="Search projects" type="search"/>
      </div>
     </form>
     <ul class="navbar-nav align-items-lg-center">
      <li class="nav-item me-2 d-none d-lg-inline">
       <a class="btn btn-outline-success" data-page="login_page" href="./login_page.html">
        Log In
       </a>
      </li>
      <li class="nav-item">
       <a class="btn btn-success" data-page="registration_page" href="./registration_page.html" style="background-color: var(--color-success, #81C784); border-color: var(--color-success, #81C784);">
        Sign Up
       </a>
      </li>
     </ul>
    </div>
   </div>
  </nav>
  <!-- Optional Offcanvas Sidebar for Public pages -->
  <style>
   :root { --primary:#81C784; --secondary:#90CAF9; }
    .brand-text { font-weight:700; color:#2e7d32; }
    .public-sidebar .nav-link { border-radius:.375rem; }
    .public-sidebar .nav-link:hover { background-color: rgba(129,199,132,.15); color:#2e7d32; }
    .public-sidebar .nav-link.active { background-color: rgba(129,199,132,.2); color:#2e7d32; }
    .public-footer a { color:#2e7d32; }
    .public-footer a:hover { color:#1565c0; }
  </style>
  <div aria-labelledby="sidebarLabel" class="offcanvas offcanvas-start public-sidebar" id="sidebarMenu" tabindex="-1">
   <div class="offcanvas-header border-bottom">
    <h5 class="offcanvas-title d-flex align-items-center" id="sidebarLabel">
     <span class="rounded-circle bg-success-subtle p-2 me-2">
     </span>
     <span class="brand-text">
      BlueCarbonMRV
     </span>
    </h5>
    <button aria-label="Close" class="btn-close" data-bs-dismiss="offcanvas" type="button">
    </button>
   </div>
   <div class="offcanvas-body d-flex flex-column">
    <div class="nav flex-column gap-1">
     <a class="nav-link d-flex align-items-center" data-page="home_page" href="./home_page.html">
      <i class="fa-solid fa-house me-2">
      </i>
      Home
     </a>
     <a class="nav-link d-flex align-items-center" data-page="marketplace_page" href="./marketplace_page.html">
      <i class="fa-solid fa-seedling me-2">
      </i>
      Projects
     </a>
     <a class="nav-link d-flex align-items-center" data-page="home_page#how" href="./home_page.html#how-it-works">
      <i class="fa-solid fa-circle-info me-2">
      </i>
      How It Works
     </a>
     <hr/>
     <a class="nav-link d-flex align-items-center" data-page="login_page" href="./login_page.html">
      <i class="fa-solid fa-right-to-bracket me-2">
      </i>
      Log In
     </a>
     <a class="nav-link d-flex align-items-center" data-page="registration_page" href="./registration_page.html">
      <i class="fa-solid fa-user-plus me-2">
      </i>
      Sign Up
     </a>
    </div>
   </div>
  </div>
  <main>
   <section class="bg-light border-bottom">
    <div class="container py-3">
     <nav aria-label="breadcrumb" class="breadcrumb">
      <ol class="breadcrumb mb-0">
       <li class="breadcrumb-item">
        <a href="./home_page.html">
         Home
        </a>
       </li>
       <li class="breadcrumb-item">
        <a href="./marketplace_page.html">
         Projects
        </a>
       </li>
       <li aria-current="page" class="breadcrumb-item active">
        Mangrove Restoration – Pesisir Selatan
       </li>
      </ol>
     </nav>
    </div>
   </section>
   <!-- Project Header -->
   <section class="py-4 py-lg-5 project-hero">
    <div class="container">
     <div class="card app-card overflow-hidden">
      <div class="card-body p-4 p-lg-5">
       <div class="d-flex flex-column flex-lg-row align-items-lg-center justify-content-between gap-3">
        <div>
         <h1 class="mb-2">
          Mangrove Restoration – Pesisir Selatan
         </h1>
         <div class="text-muted">
          by
          <a class="fw-semibold" href="./marketplace_page.html?developer=Mangrove+Alliance">
           Mangrove Alliance
          </a>
         </div>
        </div>
        <div>
         <span class="badge-soft success">
          <i class="fa-solid fa-circle-check me-2">
          </i>
          Active • Verified
         </span>
        </div>
       </div>
       <div class="row g-3 g-md-4 mt-3 mt-lg-4">
        <div class="col-12 col-md-4">
         <div class="metric-card h-100">
          <div class="d-flex align-items-center justify-content-between">
           <div>
            <div class="metric-title text-uppercase">
             Total Credits Minted
            </div>
            <div class="metric-value">
             75,000
            </div>
           </div>
           <div class="text-success-emphasis display-6">
            <i class="fa-solid fa-coins">
            </i>
           </div>
          </div>
         </div>
        </div>
        <div class="col-12 col-md-4">
         <div class="metric-card h-100">
          <div class="d-flex align-items-center justify-content-between">
           <div>
            <div class="metric-title text-uppercase">
             Available Credits
            </div>
            <div class="metric-value">
             18,250
            </div>
           </div>
           <div class="text-info display-6">
            <i class="fa-solid fa-box-open">
            </i>
           </div>
          </div>
         </div>
        </div>
        <div class="col-12 col-md-4">
         <div class="metric-card h-100">
          <div class="d-flex align-items-center justify-content-between">
           <div>
            <div class="metric-title text-uppercase">
             Project Area
            </div>
            <div class="metric-value">
             1,540
             <span class="fs-6 text-muted">
              ha
             </span>
            </div>
           </div>
           <div class="text-primary display-6">
            <i class="fa-solid fa-map-location-dot">
            </i>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </section>
   <!-- Visuals: Map + Media Gallery -->
   <section class="pb-4 pb-lg-5">
    <div class="container">
     <div class="row g-4">
      <div class="col-12 col-lg-6">
       <div class="card h-100">
        <div class="card-header d-flex align-items-center justify-content-between">
         <span class="widget-title">
          <i class="fa-solid fa-map me-2 text-success">
          </i>
          Project Location
         </span>
         <span class="text-muted small">
          Interactive
         </span>
        </div>
        <div class="card-body p-0 position-relative">
         <div class="map-container" id="projectMap">
         </div>
         <div class="position-absolute top-0 start-0 w-100 h-100 p-3" id="mapSkeleton" style="pointer-events:none;">
          <div class="skeleton w-100 h-100 rounded">
          </div>
         </div>
        </div>
        <div class="card-footer small text-muted">
         Pan and zoom to explore the boundary. Data source: GeoJSON (mock)
        </div>
       </div>
      </div>
      <div class="col-12 col-lg-6">
       <div class="card h-100">
        <div class="card-header d-flex align-items-center justify-content-between">
         <span class="widget-title">
          <i class="fa-regular fa-images me-2 text-info">
          </i>
          Media Gallery
         </span>
         <span class="text-muted small">
          Click an image to enlarge
         </span>
        </div>
        <div class="card-body">
         <div class="carousel slide" data-bs-ride="carousel" id="mediaCarousel">
          <div class="carousel-inner rounded overflow-hidden">
           <div class="carousel-item active">
            <img alt="Mangrove shoreline" class="d-block w-100 media-slide" onerror="this.onerror=null;this.src='https://picsum.photos/seed/mangrove1/800/450'" src="https://picsum.photos/id/1011/800/450"/>
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-25 rounded p-2">
             Shoreline planting site (2022)
            </div>
           </div>
           <div class="carousel-item">
            <img alt="Community nursery" class="d-block w-100 media-slide" onerror="this.onerror=null;this.src='https://picsum.photos/seed/mangrove2/800/450'" src="https://picsum.photos/id/1020/800/450"/>
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-25 rounded p-2">
             Community mangrove nursery
            </div>
           </div>
           <div class="carousel-item">
            <img alt="Aerial canopy" class="d-block w-100 media-slide" onerror="this.onerror=null;this.src='https://picsum.photos/seed/mangrove3/800/450'" src="https://picsum.photos/id/1024/800/450"/>
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-25 rounded p-2">
             Aerial canopy cover (2024)
            </div>
           </div>
          </div>
          <button class="carousel-control-prev" data-bs-slide="prev" data-bs-target="#mediaCarousel" type="button">
           <span aria-hidden="true" class="carousel-control-prev-icon">
           </span>
           <span class="visually-hidden">
            Previous
           </span>
          </button>
          <button class="carousel-control-next" data-bs-slide="next" data-bs-target="#mediaCarousel" type="button">
           <span aria-hidden="true" class="carousel-control-next-icon">
           </span>
           <span class="visually-hidden">
            Next
           </span>
          </button>
         </div>
        </div>
       </div>
      </div>
     </div>
    </div>
   </section>
   <!-- Tabs: Narrative | Verification History | Purchase Credits -->
   <section class="pb-5">
    <div class="container">
     <ul class="nav nav-tabs" id="projectTabs" role="tablist">
      <li class="nav-item" role="presentation">
       <button aria-controls="narrative" aria-selected="true" class="nav-link active" data-bs-target="#narrative" data-bs-toggle="tab" id="narrative-tab" role="tab" type="button">
        <i class="fa-regular fa-file-lines me-2">
        </i>
        Project Narrative
       </button>
      </li>
      <li class="nav-item" role="presentation">
       <button aria-controls="history" aria-selected="false" class="nav-link" data-bs-target="#history" data-bs-toggle="tab" id="history-tab" role="tab" type="button">
        <i class="fa-solid fa-timeline me-2">
        </i>
        Verification History
       </button>
      </li>
      <li class="nav-item" role="presentation">
       <button aria-controls="purchase" aria-selected="false" class="nav-link" data-bs-target="#purchase" data-bs-toggle="tab" id="purchase-tab" role="tab" type="button">
        <i class="fa-solid fa-cart-shopping me-2">
        </i>
        Purchase Credits
       </button>
      </li>
     </ul>
     <div class="tab-content border border-top-0 rounded-bottom p-3 p-lg-4 bg-white shadow-sm" id="projectTabsContent">
      <!-- Narrative Tab -->
      <div aria-labelledby="narrative-tab" class="tab-pane fade show active" id="narrative" role="tabpanel" tabindex="0">
       <div class="row g-4">
        <div class="col-12 col-lg-8">
         <h3 class="h5">
          Project Description
         </h3>
         <p>
          This blue carbon project restores degraded mangrove ecosystems along the Pesisir Selatan coastline. The primary objectives are to enhance coastal resilience, increase carbon sequestration, and support local livelihoods through community-based nursery and planting programs.
         </p>
         <p>
          Methodology follows IPCC 2013 Wetlands Supplement with rigorous field sampling and remote sensing analysis. Survival rates are continuously monitored, and biomass estimates are independently verified prior to credit issuance.
         </p>
         <hr/>
         <h4 class="h6">
          Community Story
         </h4>
         <p>
          The Mangrove Alliance partners with local fishers and women-led cooperatives to run nurseries and planting operations. Revenue from carbon credits contributes to education, equipment, and mangrove-friendly aquaculture initiatives.
         </p>
        </div>
        <div class="col-12 col-lg-4">
         <div class="card h-100">
          <div class="card-header">
           <span class="widget-title">
            <i class="fa-solid fa-chart-line me-2 text-primary">
            </i>
            Key Trends
           </span>
          </div>
          <div class="card-body">
           <canvas aria-label="Time series of credits minted and price" height="200" id="trendChart">
           </canvas>
          </div>
          <div class="card-footer small text-muted">
           12-month trend of credits minted (bars) and market price (line)
          </div>
         </div>
        </div>
       </div>
      </div>
      <!-- Verification History Tab -->
      <div aria-labelledby="history-tab" class="tab-pane fade" id="history" role="tabpanel" tabindex="0">
       <div class="accordion" id="historyAccordion">
        <!-- Event 1 -->
        <div class="accordion-item">
         <h2 class="accordion-header" id="ev1">
          <button aria-controls="ev1c" aria-expanded="true" class="accordion-button" data-bs-target="#ev1c" data-bs-toggle="collapse" type="button">
           Q2 2024 Verification • Approved • 18,500 credits minted •
           <span class="text-muted ms-2">
            2024-07-12
           </span>
          </button>
         </h2>
         <div aria-labelledby="ev1" class="accordion-collapse collapse show" data-bs-parent="#historyAccordion" id="ev1c">
          <div class="accordion-body">
           <div class="row g-3">
            <div class="col-12 col-md-8">
             <div class="d-flex flex-wrap gap-2">
              <img alt="Evidence 1" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid1/320/200'" src="https://picsum.photos/id/1039/320/200"/>
              <img alt="Evidence 2" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid2/320/200'" src="https://picsum.photos/id/1040/320/200"/>
              <img alt="Evidence 3" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid3/320/200'" src="https://picsum.photos/id/1041/320/200"/>
             </div>
            </div>
            <div class="col-12 col-md-4">
             <div class="border rounded p-3 bg-light h-100">
              <div class="mb-1">
               <strong>
                Minted:
               </strong>
               18,500 credits
              </div>
              <div class="mb-1">
               <strong>
                Verifier:
               </strong>
               OceanCarbon Labs
              </div>
              <div class="mb-1">
               <strong>
                Transaction:
               </strong>
               <a href="https://polygonscan.com/tx/0xabc123" rel="noopener" target="_blank">
                View on Polygonscan
               </a>
              </div>
              <div class="small text-muted">
               Methodology: IPCC Wetlands 2013
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
        <!-- Event 2 -->
        <div class="accordion-item">
         <h2 class="accordion-header" id="ev2">
          <button aria-controls="ev2c" aria-expanded="false" class="accordion-button collapsed" data-bs-target="#ev2c" data-bs-toggle="collapse" type="button">
           Q4 2023 Verification • Approved • 21,300 credits minted •
           <span class="text-muted ms-2">
            2023-11-28
           </span>
          </button>
         </h2>
         <div aria-labelledby="ev2" class="accordion-collapse collapse" data-bs-parent="#historyAccordion" id="ev2c">
          <div class="accordion-body">
           <div class="row g-3">
            <div class="col-12 col-md-8">
             <div class="d-flex flex-wrap gap-2">
              <img alt="Evidence 1" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid4/320/200'" src="https://picsum.photos/id/1042/320/200"/>
              <img alt="Evidence 2" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid5/320/200'" src="https://picsum.photos/id/1043/320/200"/>
              <img alt="Evidence 3" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid6/320/200'" src="https://picsum.photos/id/1044/320/200"/>
             </div>
            </div>
            <div class="col-12 col-md-4">
             <div class="border rounded p-3 bg-light h-100">
              <div class="mb-1">
               <strong>
                Minted:
               </strong>
               21,300 credits
              </div>
              <div class="mb-1">
               <strong>
                Verifier:
               </strong>
               Coastal Carbon Partners
              </div>
              <div class="mb-1">
               <strong>
                Transaction:
               </strong>
               <a href="https://polygonscan.com/tx/0xdef456" rel="noopener" target="_blank">
                View on Polygonscan
               </a>
              </div>
              <div class="small text-muted">
               Evidence includes geo-tagged photos and RS imagery.
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
        <!-- Event 3 -->
        <div class="accordion-item">
         <h2 class="accordion-header" id="ev3">
          <button aria-controls="ev3c" aria-expanded="false" class="accordion-button collapsed" data-bs-target="#ev3c" data-bs-toggle="collapse" type="button">
           Q2 2023 Verification • Approved • 15,200 credits minted •
           <span class="text-muted ms-2">
            2023-06-15
           </span>
          </button>
         </h2>
         <div aria-labelledby="ev3" class="accordion-collapse collapse" data-bs-parent="#historyAccordion" id="ev3c">
          <div class="accordion-body">
           <div class="row g-3">
            <div class="col-12 col-md-8">
             <div class="d-flex flex-wrap gap-2">
              <img alt="Evidence 1" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid7/320/200'" src="https://picsum.photos/id/1045/320/200"/>
              <img alt="Evidence 2" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid8/320/200'" src="https://picsum.photos/id/1049/320/200"/>
              <img alt="Evidence 3" class="evidence-thumb" onerror="this.onerror=null;this.src='https://picsum.photos/seed/evid9/320/200'" src="https://picsum.photos/id/1051/320/200"/>
             </div>
            </div>
            <div class="col-12 col-md-4">
             <div class="border rounded p-3 bg-light h-100">
              <div class="mb-1">
               <strong>
                Minted:
               </strong>
               15,200 credits
              </div>
              <div class="mb-1">
               <strong>
                Verifier:
               </strong>
               OceanCarbon Labs
              </div>
              <div class="mb-1">
               <strong>
                Transaction:
               </strong>
               <a href="https://polygonscan.com/tx/0x987654" rel="noopener" target="_blank">
                View on Polygonscan
               </a>
              </div>
              <div class="small text-muted">
               Cycle focused on planted area expansion.
              </div>
             </div>
            </div>
           </div>
          </div>
         </div>
        </div>
       </div>
      </div>
      <!-- Purchase Credits Tab -->
      <div aria-labelledby="purchase-tab" class="tab-pane fade" id="purchase" role="tabpanel" tabindex="0">
       <!-- Gated banner -->
       <div class="alert alert-warning d-flex align-items-center" role="alert">
        <i class="fa-solid fa-lock me-2">
        </i>
        Please log in as an Investor to purchase credits.
        <a class="ms-2 fw-semibold" href="./login_page.html">
         Log in
        </a>
       </div>
       <div class="row g-3 g-lg-4 align-items-end">
        <div class="col-12 col-md-4">
         <label class="form-label">
          Price per Credit
         </label>
         <div class="h4 mb-0" data-price="12.5" id="pricePerCredit">
          $12.50
          <span class="fs-6 text-muted">
           USD
          </span>
         </div>
         <div class="text-muted small">
          Updated 2 days ago
         </div>
        </div>
        <div class="col-12 col-md-4">
         <label class="form-label" for="quantityInput">
          Quantity
         </label>
         <div class="input-group">
          <span class="input-group-text">
           <i class="fa-solid fa-hashtag">
           </i>
          </span>
          <input class="form-control" disabled="" id="quantityInput" max="18250" min="0" placeholder="0" step="1" type="number"/>
         </div>
         <div class="form-text">
          Available:
          <strong>
           18,250
          </strong>
          credits
         </div>
        </div>
        <div class="col-12 col-md-4">
         <label class="form-label">
          Total Cost
         </label>
         <div class="h4 mb-0" id="totalCost">
          $0.00
         </div>
         <button class="btn btn-success mt-2" disabled="" id="buyBtn">
          <i class="fa-solid fa-cart-plus me-2">
          </i>
          Buy Credits
         </button>
        </div>
       </div>
       <hr class="my-4"/>
       <div class="d-flex align-items-center justify-content-between mb-2">
        <h5 class="mb-0">
         Recent Lots
        </h5>
        <div class="d-flex gap-2">
         <select class="form-select form-select-sm" id="filterStatus" style="width:auto">
          <option selected="" value="all">
           All Statuses
          </option>
          <option value="available">
           Available
          </option>
          <option value="sold">
           Sold
          </option>
         </select>
         <input class="form-control form-control-sm" id="searchLot" placeholder="Search Lot ID" style="width: 180px;" type="search"/>
        </div>
       </div>
       <div class="table-responsive">
        <table class="table table-theme table-hover align-middle" id="lotsTable">
         <thead>
          <tr>
           <th data-sort="date" role="button">
            Date
            <i class="fa-solid fa-sort ms-1">
            </i>
           </th>
           <th data-sort="lot" role="button">
            Lot ID
            <i class="fa-solid fa-sort ms-1">
            </i>
           </th>
           <th class="text-end" data-sort="qty" role="button">
            Qty
            <i class="fa-solid fa-sort ms-1">
            </i>
           </th>
           <th class="text-end" data-sort="price" role="button">
            Price
            <i class="fa-solid fa-sort ms-1">
            </i>
           </th>
           <th class="text-end">
            Total
           </th>
           <th>
            Status
           </th>
           <th>
            Tx
           </th>
          </tr>
         </thead>
         <tbody>
          <tr data-status="available">
           <td data-date="2024-08-21">
            Aug 21, 2024
           </td>
           <td data-lot="MA-2024-0821-A">
            MA-2024-0821-A
           </td>
           <td class="text-end" data-qty="2500">
            2,500
           </td>
           <td class="text-end" data-price="12.5">
            $12.50
           </td>
           <td class="text-end">
            $31,250.00
           </td>
           <td>
            <span class="badge-soft success">
             Available
            </span>
           </td>
           <td>
            <a href="https://polygonscan.com/tx/0x1" rel="noopener" target="_blank">
             View
            </a>
           </td>
          </tr>
          <tr data-status="sold">
           <td data-date="2024-08-10">
            Aug 10, 2024
           </td>
           <td data-lot="MA-2024-0810-B">
            MA-2024-0810-B
           </td>
           <td class="text-end" data-qty="3200">
            3,200
           </td>
           <td class="text-end" data-price="12.2">
            $12.20
           </td>
           <td class="text-end">
            $39,040.00
           </td>
           <td>
            <span class="badge-soft warning">
             Sold
            </span>
           </td>
           <td>
            <a href="https://polygonscan.com/tx/0x2" rel="noopener" target="_blank">
             View
            </a>
           </td>
          </tr>
          <tr data-status="available">
           <td data-date="2024-07-29">
            Jul 29, 2024
           </td>
           <td data-lot="MA-2024-0729-C">
            MA-2024-0729-C
           </td>
           <td class="text-end" data-qty="1500">
            1,500
           </td>
           <td class="text-end" data-price="12.7">
            $12.70
           </td>
           <td class="text-end">
            $19,050.00
           </td>
           <td>
            <span class="badge-soft success">
             Available
            </span>
           </td>
           <td>
            <a href="https://polygonscan.com/tx/0x3" rel="noopener" target="_blank">
             View
            </a>
           </td>
          </tr>
          <tr data-status="sold">
           <td data-date="2024-07-14">
            Jul 14, 2024
           </td>
           <td data-lot="MA-2024-0714-D">
            MA-2024-0714-D
           </td>
           <td class="text-end" data-qty="5000">
            5,000
           </td>
           <td class="text-end" data-price="12.0">
            $12.00
           </td>
           <td class="text-end">
            $60,000.00
           </td>
           <td>
            <span class="badge-soft warning">
             Sold
            </span>
           </td>
           <td>
            <a href="https://polygonscan.com/tx/0x4" rel="noopener" target="_blank">
             View
            </a>
           </td>
          </tr>
          <tr data-status="available">
           <td data-date="2024-06-30">
            Jun 30, 2024
           </td>
           <td data-lot="MA-2024-0630-E">
            MA-2024-0630-E
           </td>
           <td class="text-end" data-qty="2400">
            2,400
           </td>
           <td class="text-end" data-price="12.6">
            $12.60
           </td>
           <td class="text-end">
            $30,240.00
           </td>
           <td>
            <span class="badge-soft success">
             Available
            </span>
           </td>
           <td>
            <a href="https://polygonscan.com/tx/0x5" rel="noopener" target="_blank">
             View
            </a>
           </td>
          </tr>
          <tr data-status="sold">
           <td data-date="2024-06-12">
            Jun 12, 2024
           </td>
           <td data-lot="MA-2024-0612-F">
            MA-2024-0612-F
           </td>
           <td class="text-end" data-qty="1650">
            1,650
           </td>
           <td class="text-end" data-price="12.1">
            $12.10
           </td>
           <td class="text-end">
            $19,965.00
           </td>
           <td>
            <span class="badge-soft warning">
             Sold
            </span>
           </td>
           <td>
            <a href="https://polygonscan.com/tx/0x6" rel="noopener" target="_blank">
             View
            </a>
           </td>
          </tr>
         </tbody>
        </table>
       </div>
       <div class="d-flex justify-content-between align-items-center">
        <div class="small text-muted" id="paginationInfo">
         Showing 1–6 of 6
        </div>
        <div aria-label="Pagination" class="btn-group btn-group-sm" role="group">
         <button class="btn btn-light" disabled="">
          <i class="fa-solid fa-chevron-left">
          </i>
         </button>
         <button class="btn btn-primary">
          1
         </button>
         <button class="btn btn-light" disabled="">
          2
         </button>
         <button class="btn btn-light" disabled="">
          <i class="fa-solid fa-chevron-right">
          </i>
         </button>
        </div>
       </div>
      </div>
     </div>
    </div>
   </section>
  </main>
  <!-- Public Footer -->
  <footer class="public-footer bg-light border-top mt-auto py-4">
   <div class="container d-flex flex-column flex-md-row justify-content-between align-items-center gap-3">
    <div class="d-flex align-items-center">
     <span class="rounded-circle bg-success-subtle p-2 me-2">
     </span>
     <strong class="brand-text">
      BlueCarbonMRV
     </strong>
    </div>
    <div class="d-flex gap-3">
     <a class="text-decoration-none" href="./marketplace_page.html">
      Explore Projects
     </a>
     <a class="text-decoration-none" href="./registration_page.html">
      Register
     </a>
    </div>
    <div class="d-flex gap-3 small">
     <a class="text-decoration-none" href="./home_page.html#terms">
      Terms
     </a>
     <a class="text-decoration-none" href="./home_page.html#privacy">
      Privacy
     </a>
    </div>
   </div>
  </footer>
  <!-- Toast Container (System Feedback) -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
   <div aria-atomic="true" aria-live="polite" class="toast align-items-center text-bg-success border-0" id="liveToast" role="status">
    <div class="d-flex">
     <div class="toast-body">
      <i class="fa-solid fa-check-circle me-2">
      </i>
      Action completed successfully.
     </div>
     <button aria-label="Close" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" type="button">
     </button>
    </div>
   </div>
  </div>
  <!-- Bootstrap 5 Bundle JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js">
  </script>
  <!-- Leaflet JS -->
  <script crossorigin="" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js">
  </script>
  <!-- SweetAlert2 JS -->
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.all.min.js">
  </script>
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js">
  </script>
  <script>
   // Ensure Poppins is used
document.addEventListener('DOMContentLoaded', () => {
    document.body.style.fontFamily = "'Poppins', var(--font-sans)";

    // Bootstrap tooltips
    const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
    tooltipTriggerList.map(t => new bootstrap.Tooltip(t))
});

// Initialize Leaflet Map
const initMap = () => {
    const map = L.map('projectMap', {
        zoomControl: true
    });
    const tiles = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // Mock project boundary polygon (GeoJSON-like coordinates near Indonesia)
    const coords = [
        [-1.65, 100.55],
        [-1.68, 100.75],
        [-1.84, 100.72],
        [-1.78, 100.50]
    ];
    const polygon = L.polygon(coords.map(c => [c[0], c[1]]), {
        color: '#81C784',
        weight: 2,
        fillColor: '#81C784',
        fillOpacity: 0.25
    }).addTo(map);

    map.fitBounds(polygon.getBounds(), {
        padding: [20, 20]
    });

    // Hide skeleton on first tile load
    tiles.on('load', () => {
        const sk = document.getElementById('mapSkeleton');
        if (sk) sk.style.display = 'none';
    });
};

// Media lightbox via SweetAlert2
const initMediaLightbox = () => {
    document.querySelectorAll('.media-slide').forEach(img => {
        img.style.cursor = 'zoom-in';
        img.addEventListener('click', () => {
            Swal.fire({
                imageUrl: img.src,
                imageAlt: img.alt || 'Media',
                showConfirmButton: false,
                backdrop: true,
                width: '80%',
                background: '#fff',
            });
        });
    });
    document.querySelectorAll('.evidence-thumb').forEach(img => {
        img.style.cursor = 'zoom-in';
        img.addEventListener('click', () => {
            Swal.fire({
                imageUrl: img.src,
                imageAlt: img.alt || 'Evidence',
                showConfirmButton: false,
                backdrop: true,
                width: '60%',
                background: '#fff',
            });
        });
    });
};

// Chart.js Time Series
const initTrendChart = () => {
    const ctx = document.getElementById('trendChart');
    if (!ctx) return;
    const labels = ['Oct', 'Nov', 'Dec', 'Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'];
    const minted = [5200, 6100, 7000, 4000, 5200, 6800, 7400, 6600, 5800, 6900, 6200, 7500];
    const price = [11.8, 12.0, 12.1, 12.0, 12.2, 12.3, 12.4, 12.6, 12.5, 12.4, 12.5, 12.7];
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels,
            datasets: [{
                type: 'bar',
                label: 'Credits Minted',
                data: minted,
                backgroundColor: 'rgba(129, 199, 132, 0.6)',
                borderColor: '#81C784',
                borderWidth: 1,
                yAxisID: 'y',
            }, {
                type: 'line',
                label: 'Market Price (USD)',
                data: price,
                borderColor: '#0099D2',
                backgroundColor: 'rgba(0, 153, 210, 0.15)',
                tension: 0.3,
                yAxisID: 'y1',
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                y: {
                    beginAtZero: true,
                    title: {
                        display: true,
                        text: 'Credits'
                    }
                },
                y1: {
                    beginAtZero: false,
                    position: 'right',
                    title: {
                        display: true,
                        text: 'USD'
                    },
                    grid: {
                        drawOnChartArea: false
                    }
                }
            },
            plugins: {
                legend: {
                    position: 'bottom'
                },
                tooltip: {
                    mode: 'index',
                    intersect: false
                }
            }
        }
    });
};

// Purchase interactions (gated for non-investors)
const initPurchase = () => {
    // For demo, user is not logged in as Investor
    const isInvestor = false;
    const qtyInput = document.getElementById('quantityInput');
    const buyBtn = document.getElementById('buyBtn');
    const priceEl = document.getElementById('pricePerCredit');
    const totalEl = document.getElementById('totalCost');
    const price = parseFloat(priceEl?.getAttribute('data-price') || '0');

    const showLoginPrompt = () => {
        Swal.fire({
            icon: 'info',
            title: 'Login Required',
            html: 'Please log in as an <strong>Investor</strong> to purchase credits.',
            showCancelButton: true,
            confirmButtonText: 'Go to Login',
            cancelButtonText: 'Cancel',
            confirmButtonColor: '#81C784'
        }).then(res => {
            if (res.isConfirmed) {
                window.location.href = './login_page.html';
            }
        });
    };

    const formatCurrency = (v) => new Intl.NumberFormat('en-US', {
        style: 'currency',
        currency: 'USD'
    }).format(v || 0);

    const compute = () => {
        const qty = parseInt(qtyInput.value || '0', 10);
        const total = qty * price;
        totalEl.textContent = formatCurrency(total);
        buyBtn.disabled = !isInvestor || qty <= 0;
    };

    if (!isInvestor) {
        qtyInput.addEventListener('focus', showLoginPrompt);
        qtyInput.addEventListener('click', showLoginPrompt);
    }

    qtyInput.addEventListener('input', compute);

    buyBtn.addEventListener('click', (e) => {
        e.preventDefault();
        if (!isInvestor) return showLoginPrompt();
        const qty = parseInt(qtyInput.value || '0', 10);
        if (qty <= 0) return;

        Swal.fire({
            icon: 'success',
            title: 'Added to cart',
            text: `${qty} credits added. Proceed to checkout?`,
            showCancelButton: true,
            confirmButtonText: 'Go to Purchase',
            cancelButtonText: 'Stay',
            confirmButtonColor: '#81C784'
        }).then(res => {
            if (res.isConfirmed) {
                window.location.href = './purchase_page.html';
            } else {
                const toast = new bootstrap.Toast(document.getElementById('liveToast'));
                document.querySelector('#liveToast .toast-body').innerHTML = `<i class="fa-solid fa-check-circle me-2"></i>${qty} credits saved for checkout.`;
                toast.show();
            }
        });
    });

    // Initially compute
    compute();
};

// Sorting and filtering for lots table
const initTable = () => {
    const table = document.getElementById('lotsTable');
    if (!table) return;
    const tbody = table.querySelector('tbody');
    const headers = table.querySelectorAll('th[data-sort]');
    const filterStatus = document.getElementById('filterStatus');
    const searchLot = document.getElementById('searchLot');

    let sortKey = null;
    let sortDir = 1; // 1 asc, -1 desc

    const getVal = (tr, key) => {
        if (key === 'date') return tr.querySelector('[data-date]').getAttribute('data-date');
        if (key === 'lot') return tr.querySelector('[data-lot]').getAttribute('data-lot');
        if (key === 'qty') return parseFloat(tr.querySelector('[data-qty]').getAttribute('data-qty'));
        if (key === 'price') return parseFloat(tr.querySelector('[data-price]').getAttribute('data-price'));
        return '';
    };

    const applyFilter = () => {
        const status = filterStatus.value;
        const query = (searchLot.value || '').toLowerCase();
        Array.from(tbody.rows).forEach(tr => {
            const st = tr.getAttribute('data-status');
            const lot = tr.querySelector('[data-lot]').getAttribute('data-lot').toLowerCase();
            const statusMatch = status === 'all' || st === status;
            const searchMatch = !query || lot.includes(query);
            tr.style.display = (statusMatch && searchMatch) ? '' : 'none';
        });
        updatePaginationInfo();
    };

    const sortRows = (key) => {
        const rows = Array.from(tbody.rows).filter(r => r.style.display !== 'none');
        rows.sort((a, b) => {
            const va = getVal(a, key);
            const vb = getVal(b, key);
            if (key === 'date') return sortDir * (new Date(va) - new Date(vb));
            if (typeof va === 'number' && typeof vb === 'number') return sortDir * (va - vb);
            return sortDir * String(va).localeCompare(String(vb));
        });
        rows.forEach(r => tbody.appendChild(r));
    };

    headers.forEach(h => {
        h.addEventListener('click', () => {
            const key = h.getAttribute('data-sort');
            if (sortKey === key) sortDir = -sortDir;
            else {
                sortKey = key;
                sortDir = 1;
            }
            sortRows(key);
        });
    });

    filterStatus.addEventListener('change', applyFilter);
    searchLot.addEventListener('input', applyFilter);

    const updatePaginationInfo = () => {
        const info = document.getElementById('paginationInfo');
        const visible = Array.from(tbody.rows).filter(r => r.style.display !== 'none').length;
        const total = tbody.rows.length;
        info.textContent = `Showing ${visible} of ${total}`;
    };

    applyFilter();
};

document.addEventListener('DOMContentLoaded', () => {
    initMap();
    initMediaLightbox();
    initTrendChart();
    initPurchase();
    initTable();
});
  </script>
 </body>
</html>
